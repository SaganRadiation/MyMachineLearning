%This script finds the maximum a posteriori estimates
%for the parameters of a Weibull distribution
%Assumes an exponential prior.

propsigma = 0.3;
T=5000;
l_a = 1;
l_b = 1;

x = [2.29169513602306;2.53221630559007;3.09661253923973;5.30784291644927;2.66118344602982;1.47162262609612;5.00430825875589;5.59942788636550;2.99254232652656;6.77316012205306;4.18811661339236;2.48113959585871;4.65292248255459;1.43699924920753;1.66353852586078;2.67001141488674;2.60114999315395;2.31216283236211;2.22446286129933;2.03111376826648;3.03861665844050;3.17589581396696;4.36144369925913;5.45513185719998;2.86464175915451;1.08565441633603;8.18013336981668;3.85426385364512;0.501945179644443;3.90257739134776;1.16137249500301;2.77538585481631;4.95914036483670;1.77503409680813;0.839575508794727;4.51061143249847;1.91212301954267;4.98255115502726;1.80899937339565;0.957009855568422;0.467127447867391;2.75103012984482;3.57682380928422;0.532214392970451;0.566020247352926;2.16354123820662;1.05034560405120;4.42847366059448;3.27047560117105;1.67910714323083;10.2774152022269;1.79727076812145;1.16407708689937;3.42871884577956;1.14607494189032;3.98856389487550;2.81365584160493;1.09380126138538;0.840622447243251;4.66573772007296;3.12674823912504;2.76678487637243;1.46802287529273;4.67623106835328;2.01173255962101;3.68699905366293;6.33682380861621;3.58374443134956;1.59804261167303;3.96056669333360;3.15467670664685;4.71039408862689;0.966585893425236;0.469974845311046;2.23721103212492;0.564675528588761;5.92638229998385;3.37052514405877;1.92254184347458;4.88528222743803;0.959278578021442;0.440684809806388;0.642358240822375;1.88951494481338;2.61083299371603;1.27730437382977;4.03826301340123;1.91401897522328;2.48021704656332;2.49406520640866;1.67231357736227;5.12072347365795;4.76267411736438;0.643887203657015;3.95777979649291;3.74768802767848;4.88274610488846;3.79335842823382;0.246275126261930;3.38565510681541];

t=1;
theta=zeros(2,T);
theta(1,1) = rand;
theta(2,1) = rand;

range = [0.5 4];

while t<T
    t = t + 1;
    a = theta(1,t-1);
    b = theta(2,t-1);
    
    a_star = normrnd(a,propsigma);
    p_ratio = prod(wblpdf(x,a_star,b) ./ wblpdf(x,a,b) ) * ...
        exppdf(a_star,l_a) / exppdf(a,l_a) ;
    if rand < p_ratio
        theta(1,t) = a_star;
    else
        theta(1,t) = a;
    end
    
    b_star = normrnd(b,propsigma);
   p_ratio = prod(wblpdf(x,a,b_star) ./ wblpdf(x,a,b) ) * ...
        exppdf(b_star,l_b) / exppdf(b,l_b) ;
    if rand < p_ratio
        theta(2,t) = b_star;
    else
        theta(2,t) = b;
    end
end

figure(1);clf;
subplot(1,2,1);
nbins = 40;
abins = linspace(range(1),range(2),nbins);
bbins = linspace(range(1),range(2),nbins);
hist3(theta','Edges',{abins,bbins});
az = 20; el = 40; view(az,el);
xlabel('a');ylabel('b');